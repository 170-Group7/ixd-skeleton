/**
 * videojs_snapshot_new
 * @version 1.0.3
 * @copyright 2020 searKing <searKingChan@gmail.com>
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):t.videojsSnapshot=e(t.videojs)}(this,function(s){"use strict";s="default"in s?s["default"]:s;var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};return function n(t,e){return t(e={exports:{}},e.exports),e.exports}(function(t){var e,n;e=o,n=function(r){console.log("video-js-snapshot");var a,h,p={},t=r.registerPlugin||r.plugin,o=r.getComponent("Component"),n=r.getComponent("Button");r.SnapshoterBaseComponent=r.extend(o,{constructor:function(t,e){o.call(this,t,e)},dispose:function(){}}),r.SnapshoterComponent=r.extend(r.SnapshoterBaseComponent,{constructor:function(t,e){o.call(this,t,e),this.loadOptions(),this.resetState(),this.player().one("ready",this.setupUI.bind(this));var n=r.ImageCaptureEngine;try{this.engine=new n(this.player())}catch(s){throw new Error("Could not load "+r.ImageCaptureEngine+" plugin")}},loadOptions:function(){},setupUI:function(){this.player().controlBar.addChild(this.player().cameraButton),this.player().controlBar.el().insertBefore(this.player().cameraButton.el(),this.player().controlBar.el().firstChild),this.player().bigPlayButton.hide(),this.player().options_.controls&&(this.player().controlBar.show(),this.player().controlBar.el().style.display="flex")},isSnapshoting:function(){return this._snapshoting},isProcessing:function(){return this._processing},isDestroyed:function(){return this.player()&&null===this.player().children()},start:function(){this.isProcessing()||(this._snapshoting=!0,this._processing=!0,this.player().controlBar.playToggle.hide(),this.createSnapshot())},stop:function(){this.isProcessing()&&(this._snapshoting=!1,this._processing=!1),this.player().controlBar.playToggle.show()},destroy:function(){this.stop(),this.player().dispose(),this.resetState()},reset:function(){this.stop(),this.loadOptions(),this.resetState(),this.player().reset(),this.player().snapshotCanvas.hide(),this.player().cameraButton.hide()},resetState:function(){this._snapshoting=!1,this._processing=!1},createSnapshot:function(){var e=this;this.captureFrame().then(function(t){e.player().trigger("snap",t),e.stop()})},retrySnapshot:function(){this._processing=!1,this.player().snapshotCanvas.hide()},captureFrame:function(){var n=this,s=this.player().snapshotCanvas.el().firstChild;return s.width=this.player().videoWidth(),s.height=this.player().videoHeight(),new Promise(function(t,e){return t(n.engine.imageCaptureByIdAndCanvasDom(n.player().id(),s))})}}),h=r.extend(o),(a=r.extend(n,{constructor:function(t,e){n.call(this,t,e),this.on("click",this.onClick),this.on("tap",this.onClick)}})).prototype.onClick=function(t){t.stopImmediatePropagation();var e=this.player().snapshoter;e.isProcessing()?(e.retrySnapshot(),this.onStop()):e.start()},a.prototype.onStart=function(){this.removeClass("vjs-icon-photo-camera"),this.addClass("vjs-icon-photo-retry"),this.el().firstChild.firstChild.innerHTML=this.localize("Retry")},a.prototype.onStop=function(){this.removeClass("vjs-icon-photo-retry"),this.addClass("vjs-icon-photo-camera"),this.el().firstChild.firstChild.innerHTML=this.localize("Image")};var l=function l(t,e,n){var s={className:"vjs-"+t+"-button vjs-control vjs-icon-"+n,innerHTML:'<div class="vjs-control-content"><span class="vjs-control-text">'+e+"</span></div>"};return o.prototype.createEl("div",s,{role:"button","aria-live":"polite",tabIndex:0})},c=function c(t){var e={className:"vjs-"+t+"-canvas",innerHTML:"<canvas></canvas>"};return o.prototype.createEl("div",e)},d=function d(t,e){t.addClass("vjs-snapshot")},u=function u(t){var e=this,n=r.mergeOptions(p,t),s=this;s.ready(function(){d(e,r.mergeOptions(p,t))});for(var o=document.getElementsByTagName("video"),i=0;i<o.length;i++){o[i].setAttribute("crossOrigin","Anonymous")}s.snapshoter=new r.SnapshoterComponent(this,{options:n}),s.addChild(s.snapshoter),s.snapshotCanvas=new h(s,{el:c("snapshot")}),s.snapshotCanvas.hide(),s.snapshoter.addChild(s.snapshotCanvas),s.cameraButton=new a(s,{el:l("camera",s.localize("Image"),"photo-camera")}),s.cameraButton.show()};return t("snapshot",u),u},"function"==typeof undefined&&undefined.amd?undefined(["video.js"],n):t.exports?t.exports=n(s):e.returnExports=n(e.videojs)})});